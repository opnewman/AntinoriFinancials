<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANTINORI Financial Portfolio Reporting</title>
    
    <!-- Fonts - Inter and JetBrains Mono -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap">
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            color: #1E293B;
            background-color: #F8FAFC;
        }
        
        /* Animated progress bar for background processing */
        .progress-bar-striped {
            background-image: linear-gradient(45deg, rgba(255, 255, 255, .15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .15) 50%, rgba(255, 255, 255, .15) 75%, transparent 75%, transparent);
            background-size: 1rem 1rem;
        }
        
        .progress-bar-animated {
            animation: progress-bar-stripes 1s linear infinite;
        }
        
        @keyframes progress-bar-stripes {
            from {
                background-position: 1rem 0;
            }
            to {
                background-position: 0 0;
            }
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
        }

        code, pre {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom colors */
        .bg-primary-green {
            background-color: #14532D;
        }

        .text-primary-green {
            color: #14532D;
        }

        .bg-secondary-navy {
            background-color: #0F172A;
        }

        .text-secondary-navy {
            color: #0F172A;
        }

        .bg-accent-green {
            background-color: #22C55E;
        }

        .text-accent-green {
            color: #22C55E;
        }

        /* Financial metrics */
        .metric-up {
            color: #10B981;
        }

        .metric-down {
            color: #EF4444;
        }

        /* Stats cards */
        .stats-card {
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Chart containers */
        .chart-container {
            height: 300px;
            width: 100%;
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Navigation Bar -->
        <nav class="bg-green-900 text-white shadow-md">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo and Brand -->
                    <div class="flex items-center">
                        <div class="flex-shrink-0 font-bold text-xl tracking-tight">
                            <a href="#" class="flex items-center">
                                <i class="fas fa-chart-line mr-2"></i>
                                ANTINORI
                            </a>
                        </div>
                    </div>
                    
                    <!-- Navigation Items -->
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-center space-x-4">
                            <a href="index.html" class="px-3 py-2 rounded-md text-sm font-medium bg-green-800 text-white">
                                <i class="fas fa-dashboard mr-2"></i>
                                Dashboard
                            </a>
                            <a href="upload.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:bg-green-800 hover:text-white">
                                <i class="fas fa-upload mr-2"></i>
                                Upload Files
                            </a>
                            <a href="/ownership-tree" class="px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:bg-green-800 hover:text-white">
                                <i class="fas fa-sitemap mr-2"></i>
                                Ownership Tree
                            </a>
                            <a href="#" class="px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:bg-green-800 hover:text-white">
                                <i class="fas fa-file-text mr-2"></i>
                                Reports
                            </a>
                        </div>
                    </div>
                    
                    <!-- Mobile menu button -->
                    <div class="md:hidden">
                        <button class="inline-flex items-center justify-center p-2 rounded-md text-gray-200 hover:text-white hover:bg-green-800 focus:outline-none">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="flex-grow p-4 md:p-6">
            <div class="container mx-auto">
                <!-- Portfolio Selection Tools -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">Portfolio Report Generator</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label for="reportDate" class="block text-sm font-medium text-gray-700 mb-1">
                                Report Date
                            </label>
                            <input
                                type="date"
                                id="reportDate"
                                value="2025-05-01"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"
                            />
                        </div>
                        
                        <div>
                            <label for="reportLevel" class="block text-sm font-medium text-gray-700 mb-1">
                                Report Level
                            </label>
                            <select
                                id="reportLevel"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"
                            >
                                <option value="client">Client</option>
                                <option value="portfolio" selected>Portfolio</option>
                                <option value="group">Group</option>
                                <option value="account">Account</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="levelKey" class="block text-sm font-medium text-gray-700 mb-1">
                                Select Portfolio
                            </label>
                            <select
                                id="levelKey"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"
                            >
                                <option value="Portfolio 1" selected>Portfolio 1</option>
                                <option value="Portfolio 2">Portfolio 2</option>
                            </select>
                        </div>
                        
                        <div class="flex items-end">
                            <button
                                class="w-full py-2 px-4 rounded-md font-medium bg-green-700 text-white hover:bg-green-800"
                            >
                                <i class="fas fa-chart-line mr-2"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Portfolio Overview -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Portfolio Overview</h2>
                        <div class="text-right">
                            <div class="text-sm text-gray-500">Report Date</div>
                            <div class="text-lg font-semibold">2025-05-01</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-4">
                        <div class="bg-gray-50 p-4 rounded-lg stats-card">
                            <div class="text-sm text-gray-500 mb-1">Total Value</div>
                            <div class="text-2xl font-bold text-green-800">
                                $5,000,000.00
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg stats-card">
                            <div class="text-sm text-gray-500 mb-1">1D Performance</div>
                            <div class="text-2xl font-bold text-green-600">
                                +1.00%
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg stats-card">
                            <div class="text-sm text-gray-500 mb-1">MTD Performance</div>
                            <div class="text-2xl font-bold text-green-600">
                                +3.00%
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg stats-card">
                            <div class="text-sm text-gray-500 mb-1">YTD Performance</div>
                            <div class="text-2xl font-bold text-green-600">
                                +9.00%
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Asset Allocation Chart -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-3">Asset Allocation</h3>
                        <div class="chart-container">
                            <canvas id="allocationChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Liquidity Chart -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-3">Liquidity Profile</h3>
                        <div class="chart-container">
                            <canvas id="liquidityChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Chart -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Performance</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <!-- Risk Metrics -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Risk Metrics</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Volatility</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">12.50%</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Sharpe Ratio</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">1.80</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Beta</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">0.85</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-4 text-center text-sm">
            <div class="container mx-auto">
                <p>ANTINORI Financial Portfolio Reporting System &copy; 2025</p>
                <p class="text-gray-400 text-xs mt-1">
                    Powered by Tauri, React, Java/SpringBoot, and PostgreSQL
                </p>
            </div>
        </footer>
    </div>
    
    <!-- Initialize Charts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dashboard Variables
            const today = new Date().toISOString().substring(0, 10); // Format: YYYY-MM-DD
            const defaultLevel = 'client';
            const defaultLevelKey = 'All Clients'; // Default to All Clients
            
            let allocationChart, liquidityChart, performanceChart;
            
            // Create charts with loading state
            initializeCharts();
            
            // Fetch real data from API endpoints
            loadDashboardData();
            
            // Initialize charts with loading state
            function initializeCharts() {
                // Asset Allocation Chart - loading state
                const allocationCtx = document.getElementById('allocationChart').getContext('2d');
                allocationChart = new Chart(allocationCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Loading...'],
                        datasets: [{
                            data: [100],
                            backgroundColor: ['#e5e7eb'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        family: 'Inter, sans-serif'
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
                
                // Liquidity Chart - loading state
                const liquidityCtx = document.getElementById('liquidityChart').getContext('2d');
                liquidityChart = new Chart(liquidityCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Loading...'],
                        datasets: [{
                            data: [100],
                            backgroundColor: ['#e5e7eb'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        family: 'Inter, sans-serif'
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Load dashboard data from API
            function loadDashboardData() {
                // Show loading indicator
                document.querySelectorAll('.loading-indicator').forEach(el => {
                    el.style.display = 'flex';
                });
                
                // Fetch asset allocation data
                fetch(`/api/charts/allocation?date=${today}&level=${defaultLevel}&level_key=${encodeURIComponent(defaultLevelKey)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.labels && data.datasets) {
                            updateAllocationChart(data);
                        } else {
                            console.error('Invalid allocation data format:', data);
                            // Fallback to sample data if API fails
                            updateAllocationChart({
                                labels: ['Equities', 'Fixed Income', 'Alternatives', 'Cash'],
                                datasets: [{
                                    data: [45.5, 30.0, 15.5, 9.0],
                                    backgroundColor: ['#4C72B0', '#55A868', '#C44E52', '#8172B3'],
                                    borderWidth: 1
                                }]
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching allocation data:', error);
                        // Fallback to sample data if API fails
                        updateAllocationChart({
                            labels: ['Equities', 'Fixed Income', 'Alternatives', 'Cash'],
                            datasets: [{
                                data: [45.5, 30.0, 15.5, 9.0],
                                backgroundColor: ['#4C72B0', '#55A868', '#C44E52', '#8172B3'],
                                borderWidth: 1
                            }]
                        });
                    });
                
                // Fetch liquidity data
                fetch(`/api/charts/liquidity?date=${today}&level=${defaultLevel}&level_key=${encodeURIComponent(defaultLevelKey)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.labels && data.datasets) {
                            updateLiquidityChart(data);
                        } else {
                            console.error('Invalid liquidity data format:', data);
                            // Fallback to sample data if API fails
                            updateLiquidityChart({
                                labels: ['Daily', 'Weekly', 'Monthly', 'Quarterly', 'Yearly'],
                                datasets: [{
                                    data: [60.0, 15.0, 10.0, 10.0, 5.0],
                                    backgroundColor: ['#4C72B0', '#55A868', '#C44E52', '#8172B3', '#CCB974'],
                                    borderWidth: 1
                                }]
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching liquidity data:', error);
                        // Fallback to sample data if API fails
                        updateLiquidityChart({
                            labels: ['Daily', 'Weekly', 'Monthly', 'Quarterly', 'Yearly'],
                            datasets: [{
                                data: [60.0, 15.0, 10.0, 10.0, 5.0],
                                backgroundColor: ['#4C72B0', '#55A868', '#C44E52', '#8172B3', '#CCB974'],
                                borderWidth: 1
                            }]
                        });
                    });
                
                // Fetch performance data
                fetch(`/api/charts/performance?date=${today}&level=${defaultLevel}&level_key=${encodeURIComponent(defaultLevelKey)}&period=YTD`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.labels && data.datasets) {
                            updatePerformanceChart(data);
                        } else {
                            console.error('Invalid performance data format:', data);
                            // Fallback to sample data if API fails
                            updatePerformanceChart({
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [{
                                    label: 'Performance (%)',
                                    data: [1.2, 0.8, -0.5, 1.5, 2.0, 1.0, 1.8, 0.7, -1.0, 2.5, 1.0, 1.0],
                                    borderColor: '#4C72B0',
                                    backgroundColor: 'rgba(76, 114, 176, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }]
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching performance data:', error);
                        // Fallback to sample data if API fails
                        updatePerformanceChart({
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                            datasets: [{
                                label: 'Performance (%)',
                                data: [1.2, 0.8, -0.5, 1.5, 2.0, 1.0, 1.8, 0.7, -1.0, 2.5, 1.0, 1.0],
                                borderColor: '#4C72B0',
                                backgroundColor: 'rgba(76, 114, 176, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        });
                    });
                
                // Update last data refresh time
                document.getElementById('lastRefreshed').textContent = new Date().toLocaleString();
            }
            
            // Update allocation chart with data
            function updateAllocationChart(data) {
                allocationChart.data.labels = data.labels;
                allocationChart.data.datasets = data.datasets;
                allocationChart.update();
            }
            
            // Update liquidity chart with data
            function updateLiquidityChart(data) {
                liquidityChart.data.labels = data.labels;
                liquidityChart.data.datasets = data.datasets;
                liquidityChart.update();
            }
            
            // Initialize Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: ['Loading...'],
                    datasets: [{
                        label: 'Performance (%)',
                        data: [0],
                        borderColor: '#e5e7eb',
                        backgroundColor: 'rgba(229, 231, 235, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Add performance chart loading
            function updatePerformanceChart(data) {
                performanceChart.data.labels = data.labels;
                performanceChart.data.datasets = data.datasets;
                performanceChart.update();
            }
            
            // Also fetch performance data in loadDashboardData function
            // Add this inside the loadDashboardData function before the closing curly brace
            fetch(`/api/charts/performance?date=${today}&level=${defaultLevel}&level_key=${encodeURIComponent(defaultLevelKey)}&period=YTD`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.labels && data.datasets) {
                        updatePerformanceChart(data);
                    } else {
                        console.error('Invalid performance data format:', data);
                        // Fallback to sample data if API fails
                        updatePerformanceChart({
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                            datasets: [{
                                label: 'Performance (%)',
                                data: [1.2, 0.8, -0.5, 1.5, 2.0, 1.0, 1.8, 0.7, -1.0, 2.5, 1.0, 1.0],
                                borderColor: '#4C72B0',
                                backgroundColor: 'rgba(76, 114, 176, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching performance data:', error);
                    // Fallback to sample data if API fails
                    updatePerformanceChart({
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Performance (%)',
                            data: [1.2, 0.8, -0.5, 1.5, 2.0, 1.0, 1.8, 0.7, -1.0, 2.5, 1.0, 1.0],
                            borderColor: '#4C72B0',
                            backgroundColor: 'rgba(76, 114, 176, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    });
                });
        });
    </script>
</body>
</html>
